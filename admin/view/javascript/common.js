_base_translate = {
    datepicker: {
        back: "Назад:",
        forward: "Вперед:",
        "1year": "1 год",
        "6months": "полгода",
        "3months": "3 месяца",
        "2months": "2 месяца",
        "1month": "1 месяц",
        "3weeks": "3 недели",
        "2weeks": "2 недели",
        "1week": "1 неделя",
        "6days": "6 дней",
        "5days": "5 дней",
        "4days": "4 дня",
        "3days": "3 дня",
        "2days": "2 дня",
        "1day": "1 день",
        today: "Сегодня",
        abs: "Календарь",
        rel: "Относительные даты"
	},
    month_genitive: {
        "01": "января",
        "02": "февраля",
        "03": "марта",
        "04": "апреля",
        "05": "мая",
        "06": "июня",
        "07": "июля",
        "08": "августа",
        "09": "сентября",
        "10": "октября",
        "11": "ноября",
        "12": "декабря"
	},
    chosen: {
        select_multiple: "Выберите значения",
        select_one: "Выберите значение",
        no_results: "Нет совпадений для",
        no_values: "Значения отсутствуют",
        not_active: "Неактивен",
        add: "Добавить"
	},
    confirm: {
        payment_delete: "Вы уверены, что хотите удалить данную оплату?",
        delete_action: "Вы уверены, что хотите удалить данное действие?",
        delete_date: "Вы действительно хотите удалить эту дату?",
        delete_demo_data: "Вы уверены, что хотите удалить все демо-данные?\n\nБудут удалены:\n* Демо-магазин\n* Менеджеры\n* Все товары\n* Все заказы\n* Все клиенты",
        delete_dictionary: "Вы действительно хотите удалить этот справочник?",
        delete_excluded_days: "Вы действительно хотите удалить выбранные нерабочие даты?",
        delete_file: "Вы действительно хотите удалить файл?",
        delete_product_group_from_rule: "Вы уверены, что хотите удалить из правила этот товар/категорию товаров?",
        delete_time_interval: "Вы действительно хотите удалить этот временной интервал?",
        delete_validation: "Вы действительно хотите удалить эту валидацию?",
        delete_working_time: "Вы действительно хотите удалить это рабочее время?",
        close_popup: "Вы уверены что хотите закрыть всплывающее окно? Все изменения будут потеряны.",
        set_text_template: "Поле «Шаблон текста» будет заменен значением из выбранного шаблона.\nВы уверены, что хотите использовать значения шаблона?",
        fiscal_refund: "Вы уверены, что хотите сделать возврат чека?",
        delete_cost: "Вы действительно хотите удалить этот расход?"
	},
    alert: {
        replace_fields_by_template: "Поля %fields% будут заменены значениями из выбранного шаблона.\nВы уверены, что хотите использовать значения шаблона?",
        customer_history_error: "Не удалось загрузить историю изменений информации о клиенте заказа.\n\nОбратитесь в службу поддержки для устранения ошибки.",
        data_load_error: "Не удалось загрузить данные.Обратитесь к администратору для устранения ошибки",
        delivery_list_load_error: "Не удалось загрузить список служб доставки.Обратитесь к администратору для устранения ошибки",
        load_quota_list_error: "Не удалось загрузить список доступных квот.Обратитесь к администратору для устранения ошибки",
        request_error_try_later: "Возникла ошибка при обработке запроса. Мы уже уведомлены об ошибке и устраним ее в ближайшее время. Попробуйте еще раз чуть позже.",
        send_notification_error: "Произошла ошибка при обработке запроса. Уведомление не удалось отправить.",
        order_history_error: "Не удалось загрузить историю изменений статусов заказа.Обратитесь в службу поддержки для устранения ошибки.",
        product_group_load_error: "Не удалось загрузить список групп товаров в выбранном сайте.Обратитесь к администратору для устранения ошибки",
        customer_with_id_not_found: "Клиент с указанным идентифкатором не найден.",
        add_order_product_error: "Не удалось добавить товар к заказу.Обратитесь к администратору для устранения ошибки.",
        add_order_cost_error: "Не удалось добавить товар к заказу.Обратитесь к администратору для устранения ошибки.",
        error_or_not_access: "Возникла ошибка при загрузке данных либо у вас недостаточно прав для выполнения операции.",
        action_not_allowed_for_event: "Действие «%action%» не разрешено для события «%event%». Вам необходимо удалить либо заменить это действие.",
        need_select_event_for_rule: "Вам необходимо выбрать событие, на которое будет распространяться правило.",
        invalid_payment_type_for_delivery: "Тип оплаты «%payment%» не поддерживается для способа доставки «%delivery%»",
        invalid_payment_status_for_type: "Статус оплаты «%status%» не поддерживается для типа оплаты «%type%»",
        invalid_delivery_type_for_country: "Тип доставки «%delivery%» не поддерживается для страны «%country%»",
        phones_must_be_set: "Должен быть указан хотя бы один телефон",
        invalid_phone_number: "Указан некорректный номер телефона",
        invalid_shipment_store_for_delivery: "Склад отгрузки «%shipmentStore%» не поддерживается для способа доставки «%delivery%»",
        invalid_shipment_store_for_site: "Склад отгрузки «%shipmentStore%» не доступен для магазина «%site%»",
        recommendation_failed: "Не удалось получить список рекомендаций для товара",
        change_site: "При изменении магазина будет удален внешний идентификатор и связь заказа с данным магазином будет потеряна.\nВы уверены, что хотите изменить магазин?",
        price_type_not_available: "Текущий тип цены не доступен для данного заказа",
        not_selected_fields: "Не выбрано ни одно поле",
        no_kladr_for_location: "Отсутствует код КЛАД для данного населенного пункта"
	},
    message: {
        no_customer_delivery_address: "Не удалось найти адрес доставки в заказах клиента",
        need_set_fields: "Заполните поля",
        need_set_site: "Укажите магазин",
        need_set_store: "Укажите склад",
        need_set_weight: "Укажите вес",
        need_set_length: "Укажите длину",
        need_set_width: "Укажите ширину",
        need_set_height: "Укажите высоту",
        need_set_parcel_weight: "Укажите вес послыки",
        need_set_parcel_length: "Укажите длину послыки",
        need_set_parcel_width: "Укажите ширину послыки",
        need_set_parcel_height: "Укажите высоту послыки",
        need_set_delivery_city: "Укажите город доставки",
        need_set_content_type: "тип содержимого",
        need_set_from_terminal: "терминал отправки",
        need_set_delivery_time: "Укажите время доставки",
        need_set_region: "Укажите регион",
        need_set_city: "Укажите город",
        need_set_street: "Укажите улицу",
        need_set_building: "Укажите номер дома",
        need_set_delivery_type: "Укажите тип доставки",
        need_set_payment_type: "Укажите тип оплаты",
        need_set_field: "Укажите",
        error_on_load_try_later: "Возникла ошибка при загрузке данных. Попробуйте еще раз чуть позже.",
        no_notifications: "Нет уведомлений к отображению.",
        no_additional_customer_data: "Не удалось найти дополнительные сведения о покупателе",
        no_delivery_address: "Не удалось найти адрес доставки",
        error_on_request_handle: "Возникла ошибка при обработке запроса.\nМы уже уведомлены об ошибке и устраним ее в ближайшее время.",
        unsaved_changes: "Вы изменили данные на странице.\nПри переходе все несохраненные данные будут потеряны.",
        parse_address_fail: "Не удалось распознать адрес",
        you_have_no_tasks: "У вас нет задач.",
        customer_doubles_combine_error: "Произошла ошибка. Объединение клиентов не удалось.",
        customer_doubles_check_error: "Ошибка при проверке объединения клиентов.",
        telephony_call_fail: "Не удалось инициировать звонок",
        telephony_call_record_fail: "Не удалось воспроизвести файл",
        range_has_intersections: "Диапазоны не должны пересекаться",
        range_start_bigger_end: "Конец диапазона не должен быть меньше чем начало",
        should_not_be_blank: "Значение не должно быть пустым",
        no_actions_available: "Нет доступных действий",
        show_other_events: "Показать еще %count% событие|Показать еще %count% события|Показать еще %count% событий",
        unsubscribe: "Отписаться",
        add_unsubscribe_url: "Ссылка отписки от рассылки",
        unsubscribe_text: "Текст",
        note_successfully_created: "Заметка успешно создана.",
        letter_successfully_sent: "Письмо успешно отправлено.|Письмо успешно отправлено %count% получателям.|Письмо успешно отправлено %count% получателям.",
        can_not_send_letter_to_recipients: "Письмо не удалось отправить получателю %recipients%.|Письмо не удалось отправить получателям %recipients%.|Письмо не удалось отправить получателям %recipients%.",
        sms_successfully_sent: "Sms успешно отправлено.",
        task_successfully_created: "Задача успешно добавлена.",
        save_order_payment: "Чтобы отправить ссылку на оплату необходимо сохранить заказ."
	},
    info: {
        yes: "Да",
        no: "Нет",
        vat: "НДС",
        without_vat: "Без НДС",
        select_vat_rate: "Выберите ставку",
        from_who: "От кого",
        plate: "Печатная форма",
        subject_recipient_and_template: "«Тема», «Получатель» и «Шаблон письма»",
        type: "тип",
        none: "Отсутствуют",
        no_select_fem: "Не выбрана",
        no_select_mas: "Не выбран",
        cash_limit: "Ограничение оплаты наличными",
        no_reserve_fem: "Не забронирована",
        to_door: "До двери",
        pickup_point: "ПВЗ",
        prepare_to_download: "Подготовка файла к скачиванию",
        checked_all: "Выделены все элементы",
        checked_elements: "Выделен %count% элемент|Выделено %count% элемента|Выделено %count% элементов",
        notification: "Уведомление",
        error: "Ошибка",
        select_option: "Выберите вариант",
        in_order: "В&nbsp;заказе",
        all_products_for_filter: "Все товары для выбранного фильтра.",
        and_more_count_products: "И еще %count% товар|И еще %count% товара|И еще %count% товаров",
        primary_address: "Исходный адрес",
        check_as_completed: "Отметить выполненной",
        check_as_not_completed: "Отметить не выполненной",
        customer_doubles_diff_fields_amount: "В выделенных карточках обнаружено %count% конфликтующее поле|В выделенных карточках обнаружено %count% конфликтующих поля|В выделенных карточках обнаружено %count% конфликтующих полей",
        customer_doubles_title: "Имеются дубли",
        call_history_with_span: "%span%История%espan% %span%звонков%espan%",
        call_history: "История звонков",
        not_set: "Не выбран",
        and: "и",
        nothing_found: "Ничего не найдено",
        email_template_sender_vetification: "Домен %domain% не верифицирован. Доставляемость писем от неверифицированного домена может быть низкой",
        courier_day_plan: "Запланировано на этот день",
        courier_delivery_from_warehouse: "Доставка товара со склада %warehouse%|Доставка товаров со склада %warehouse%|Доставка товаров со склада %warehouse%",
        courier_free: "Курьер свободен в этот день",
        courier_warehouse_unknown: "Неизвестно",
        selected_regions: "Выбран %count% регион|Выбрано %count% региона|Выбрано %count% регионов",
        is_being_watchig: "Просматривает|Просматривают|Просматривают",
        other_users: "еще %count% пользователь|еще %count% пользователя|еще %count% пользователей",
        not_associated_geohelper: "Значение не связано с Geohelper. Кликните для выбора значения из Geohelper",
        no_price_types: "Нет доступных типов цен"
	},
    label: {
        region: "регион",
        street: "улица",
        city: "город",
        build: "дом",
        terminal_working_time: "Время работы терминала",
        terminal_address: "Адрес терминала"
	},
    placeholder: {
        tracking_enabled: "Отслеживание включено",
        tracking_disabled: "Отслеживание отключено"
	},
    button: {
        apply: "Применить",
        show_next: "Показать следующие %nextCount%",
        shown_orders: "Показано заказов: %currentCount% из %count%",
        shown_sms: "Показано SMS: %currentCount% из %count%",
        shown_letters: "Показано писем: %currentCount% из %count%",
        copy: "Скопировать",
        copied: "Скопировано",
        add: "Добавить",
        save: "Сохранить"
	},
    link: {
        reset: "Сбросить",
        related_products: "Сопутствующие товары",
        doubles: "%count% %s%дубль%ends%|%count% %s%дубля%ends%|%count% %s%дублей%ends%",
        packages: "Всего %count% упаковка|Всего %count% упаковки|Всего %count% упаковок",
        add_new_note: "Добавить новую",
        add_new_letter: "Добавить новое",
        add_new_sms: "Добавить новое",
        add_new_task: "Добавить новую"
	},
    filter: {
        show: "Развернуть фильтр",
        hide: "Свернуть фильтр"
	},
    measure: {
        years: {
            cont: "г",
            full: "%count% год|%count% года|%count% лет"
		},
        months: {
            cont: "мес",
            full: "%count% месяц|%count% месяца|%count% месяцев"
		},
        days: {
            cont: "дн",
            full: "%count% день|%count% дня|%count% дней"
		},
        day: {
            cont: "дн."
		},
        symbol: {
            full: "символ|символа|символов"
		},
        products: {
            full: "%count% товар|%count% товара|%count% товаров"
		}
	},
    error: {
        upload_failed: "Не удалось загрузить файл"
	},
    validator: {
        right_value_of_time_interval_must_be_more_than_the_left_one: "Правое значение временного интервала должно быть больше левого",
        date_value_can_not_be_empty: "Дата не должна быть пустой",
        start_date_value_can_not_be_empty: "Дата начала не должна быть пустой",
        end_date_value_can_not_be_empty: "Дата конца не должна быть пустой",
        non_working_dates_must_be_unique_and_should_not_cross_with_the_existing_ones: "Нерабочие даты должны быть уникальными и не должны пересекаться с существующими"
	}
};
jQuery(function(a) {
    a.datepicker.regional.ru = {
        closeText: "Закрыть",
        prevText: "Предыдущий месяц",
        nextText: "Следующий месяц",
        currentText: "Сегодня",
        monthNames: ["Январь", "Февраль", "Март", "Апрель", "Май", "Июнь", "Июль", "Август", "Сентябрь", "Октябрь", "Ноябрь", "Декабрь"],
        monthNamesShort: ["Январь", "Февраль", "Март", "Апрель", "Май", "Июнь", "Июль", "Август", "Сентябрь", "Октябрь", "Ноябрь", "Декабрь"],
        dayNames: ["воскресенье", "понедельник", "вторник", "среда", "четверг", "пятница", "суббота"],
        dayNamesShort: ["вск", "пнд", "втр", "срд", "чтв", "птн", "сбт"],
        dayNamesMin: ["Вс", "Пн", "Вт", "Ср", "Чт", "Пт", "Сб"],
        weekHeader: "Не",
        dateFormat: "dd.mm.yy",
        firstDay: 1,
        isRTL: false,
        showMonthAfterYear: false,
        yearSuffix: ""
	};
    a.datepicker.setDefaults(a.datepicker.regional.ru)
});

function setAudioTrigger(){
	$('audio[class!=donotstop]').on('play', function(){
		var current = $(this);					
		$('audio').each(function(){						
			if ($(this)[0].paused == false && $(this)[0].src != current[0].src){
				$(this).trigger("pause");
			}
		})
	});
}


var availableDomains = {
    base: _base_translate
};

function _translate(b, g, e) {
    if ("object" != typeof g) {
        g = {}
	}
    if ("undefined" == typeof e) {
        e = "base"
	}
    var c = b.split(".");
    var a = availableDomains[e];
    for (var d in c) {
        if ("undefined" === typeof a[c[d]]) {
            return b
		}
        a = a[c[d]]
	}
    var f = a;
    for (var d in g) {
        f = f.replace(new RegExp("%" + d + "%", "g"), g[d])
	}
    return f
}

function _getDateFormatString(){
	return "yy-mm-dd";
}

(function ($) {
	$.extend($.datepicker, {
		
		// Reference the orignal function so we can override it and call it later
		_inlineDatepicker2: $.datepicker._inlineDatepicker,
		
		// Override the _inlineDatepicker method
		_inlineDatepicker: function (target, inst) {
			
			// Call the original
			this._inlineDatepicker2(target, inst);
			
			var beforeShow = $.datepicker._get(inst, 'beforeShow');
			
			if (beforeShow) {
				beforeShow.apply(target, [target, inst]);
			}
		}
	});
}(jQuery));

function u(E) {
	E.find(".datepicker:not(.datepicker-custom),.date:not(.datepicker-custom)").datepicker({
		dateFormat: _getDateFormatString()
	});
	E.find('.date-new').datepicker({
		dateFormat: _getDateFormatString(),
		showOtherMonths: true,
		selectOtherMonths: true,
		onSelect: function(G, F) {
			var H = $(this);
			H.parent().find(".absolute-date").val($.datepicker.formatDate("yy-mm-dd", new Date(F.selectedYear, F.selectedMonth, F.selectedDay)));
			H.parent().find(".relative-date").val("");
			if (H.hasClass("ignore-year-datepicker")) {
				H.datepicker("option", "dateFormat", _getDateFormatString(true))
				} else {
				H.datepicker("option", "dateFormat", _getDateFormatString())
			}
		},
		beforeShow: function(F, H) {			
			var G = $("#ui-datepicker-div");
			var I = $(F);
			G.addClass("switching");
			d();
			I.addClass("active-datepicker");
			if (I.hasClass("ignore-year-datepicker")) {
				G.addClass("hide-year")
				} else {
				G.removeClass("hide-year")
			}
		},
		onClose: function(G, F) {
			$("#ui-datepicker-div").removeClass("rel-dates-show").removeClass("switching").removeClass("hide-year");
			$(this).removeClass("active-datepicker").attr("disabled", false)
		}
	})
}

$.fn.initJsControls = function() {
	var E = $(this);
	E.each(function() {
		var F = $(this);
		if (!F.is("select")) {
			F = F.find("select:not(.hide)")
		}         
	});
	u(E);
};

$(document).ready(function(){
	$("body").initJsControls();
	$("#ui-datepicker-div").delegate(".ui-datepicker-prev, .ui-datepicker-next", "click", d);
});



function d() {	
	clearTimeout(d.timer);
	if ($("#ui-datepicker-div .ui-datepicker-calendar").is(":visible")) {
		var E = '<div class="rel-dates-list">';
		E += '<p class="wt-smoke">' + _translate("datepicker.back") + "</p>";
		E += '<p class="relative">';
		E += '<a data-value="-1 year" href="#">' + _translate("datepicker.1year") + "</a>";
		E += '<a data-value="-6 months" href="#">' + _translate("datepicker.6months") + "</a>";
		E += '<a data-value="-3 months" href="#">' + _translate("datepicker.3months") + "</a>";
		E += '<a data-value="-2 months" href="#">' + _translate("datepicker.2months") + "</a>";
		E += '<a data-value="-1 month" href="#">' + _translate("datepicker.1month") + "</a>";
		E += '<a data-value="-3 weeks" href="#">' + _translate("datepicker.3weeks") + "</a>";
		E += '<a data-value="-2 weeks" href="#">' + _translate("datepicker.2weeks") + "</a>";
		E += '<a data-value="-1 week" href="#">' + _translate("datepicker.1week") + "</a>";
		E += '<a data-value="-6 days" href="#">' + _translate("datepicker.6days") + "</a>";
		E += '<a data-value="-5 days" href="#">' + _translate("datepicker.5days") + "</a>";
		E += '<a data-value="-4 days" href="#">' + _translate("datepicker.4days") + "</a>";
		E += '<a data-value="-3 days" href="#">' + _translate("datepicker.3days") + "</a>";
		E += '<a data-value="-2 days" href="#">' + _translate("datepicker.2days") + "</a>";
		E += '<a data-value="-1 day" href="#">' + _translate("datepicker.1day") + "</a>";
		E += "</p>";
		E += '<p class="relative"><a data-value="today" href="#">' + _translate("datepicker.today") + "</a></p>";
		E += '<p class="wt-smoke">' + _translate("datepicker.forward") + "</p>";
		E += '<p class="relative">';
		E += '<a data-value="+1 day" href="#">' + _translate("datepicker.1day") + "</a>";
		E += '<a data-value="+2 days" href="#">' + _translate("datepicker.2days") + "</a>";
		E += '<a data-value="+3 days" href="#">' + _translate("datepicker.3days") + "</a>";
		E += '<a data-value="+4 days" href="#">' + _translate("datepicker.4days") + "</a>";
		E += '<a data-value="+5 days" href="#">' + _translate("datepicker.5days") + "</a>";
		E += '<a data-value="+6 days" href="#">' + _translate("datepicker.6days") + "</a>";
		E += '<a data-value="+1 week" href="#">' + _translate("datepicker.1week") + "</a>";
		E += '<a data-value="+2 weeks" href="#">' + _translate("datepicker.2weeks") + "</a>";
		E += '<a data-value="+3 weeks" href="#">' + _translate("datepicker.3weeks") + "</a>";
		E += '<a data-value="+1 month" href="#">' + _translate("datepicker.1month") + "</a>";
		E += '<a data-value="+2 months" href="#">' + _translate("datepicker.2months") + "</a>";
		E += '<a data-value="+3 months" href="#">' + _translate("datepicker.3months") + "</a>";
		E += '<a data-value="+6 months" href="#">' + _translate("datepicker.6months") + "</a>";
		E += '<a data-value="+1 year" href="#">' + _translate("datepicker.1year") + "</a>";
		E += "</p>";
		E += "</div>";
		E += '<a class="rel-reset-btn" href="#"><i class="icon-times"></i>' + _translate("link.reset") + "</a>";
		E += '<a class="rel-dates-btn" href="#">' + _translate("datepicker.rel") + "</a>";
		$("#ui-datepicker-div").append(E)
		} else {
		d.timer = setTimeout(d, 10)
	}
}

$("#ui-datepicker-div .rel-dates-list .relative a").on("click", function(F) {
	F.preventDefault();
	var E = $(this).data("value")[0];
	if (E == "-" || E == "+") {
		E = E.replace("–", "-")
		} else {
		E = ""
	}
	$(".active-datepicker").parent().find(".absolute-date").val("");
	$(".active-datepicker").parent().find(".relative-date").val($(this).data("value"));
	$(".active-datepicker").val(E + $(this).text());
	$(".active-datepicker").datepicker("hide")
});
$("#ui-datepicker-div .rel-dates-btn").on("click", function(G) {
	G.preventDefault();
	var E = $("#ui-datepicker-div"),
	F = $(this);
	if (E.hasClass("rel-dates-show")) {
		E.removeClass("rel-dates-show");
		F.text(_translate("datepicker.rel"));
		$(".active-datepicker").attr("disabled", false)
		} else {
		E.addClass("rel-dates-show");
		F.text(_translate("datepicker.abs"));
		$(".active-datepicker").attr("disabled", "disabled")
	}
});
$("#ui-datepicker-div .rel-reset-btn").on("click", function(E) {
	E.preventDefault();
	$(".active-datepicker").val("").parent().find(".absolute-date, .relative-date").val("");
	$(".active-datepicker").datepicker("hide")
});

function getURLVar(key) {
	var value = [];
	
	var query = String(document.location).split('?');
	
	if (query[1]) {
		var part = query[1].split('&');
		
		for (i = 0; i < part.length; i++) {
			var data = part[i].split('=');
			
			if (data[0] && data[1]) {
				value[data[0]] = data[1];
			}
		}
		
		if (value[key]) {
			return value[key];
			} else {
			return '';
		}
	}
} 

$(document).ready(function() {
	route = getURLVar('route');
	
	if (!route) {
		$('#dashboard').addClass('selected');
		} else {
		part = route.split('/');
		
		url = part[0];
		
		if (part[1]) {
			url += '/' + part[1];
		}
		
		$('a[href*=\'' + url + '\']').parents('li[id]').addClass('selected');
	}
	
	$('#menu > ul > li').on('click', function() {
		if ($(this).hasClass('hover')){
			$(this).removeClass('hover');
			} else {
			$(this).addClass('hover');			
		}
	});
	
	$('#menu_top > ul > li').on('click', function() {
		if ($(this).hasClass('hover')){
			$(this).removeClass('hover');
			} else {
			$(this).addClass('hover');			
		}
	});
	
	$('#menu ul li').on('mouseout', function() {
		//	$(this).removeClass('hover');
	});	
	
	$(".tooltip").tooltip();
	
	$(".ui-datepicker-calendar").append( "<p>Test</p>" );
	
});